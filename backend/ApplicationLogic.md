# Бизнес-логика приложения SkateGo

> **Внимание:** Описания ниже соответствуют состоянию моделей Django в приложениях `skatego`, `users`, `reviews`. В случае расхождений приоритет имеют модели в коде.

## Общее описание
SkateGo - это платформа для аренды электроскейтбордов. Пользователи могут находить, арендовать и возвращать электроскейтборды через мобильное приложение или веб-интерфейс.

## Основные сущности

### 1. Модель электроскейтборда (SkateboardModel)
**Описание:** Тип/модель электроскейтборда с техническими характеристиками

**Характеристики:**
- **Название модели** — строка, до 100 символов (уникальность не гарантируется на уровне модели)
- **Описание** — текст
- **Максимальная скорость** — положительное целое число, 1–200 км/ч
- **Емкость батареи** — вещественное число, 0–120 Ач (в модели: `battery_capacity_from_factory_ah`)
- **Верхний предел напряжения батареи** — вещественное число, 1–120 В (`max_battery_voltage_v`)
- **Нижний предел напряжения батареи** — вещественное число, 0–120 В (`min_battery_voltage_v`)
- **Запас хода** — положительное целое число, 1–200 км

**Бизнес-правила:**
- Все технические характеристики валидируются через диапазоны
- Модели не удаляются, а помечаются как неактивные — **не реализовано**
- Уникальность названия — **не реализовано**

### 2. Электроскейтборд (Skateboard)
**Описание:** Конкретный экземпляр электроскейтборда

**Характеристики:**
- **Модель** — связь с SkateboardModel
- **Серийный номер** — строка, до 50 символов, уникальный
- **Текущая ёмкость батареи (Ah)** — вещественное число, 0–120
- **Текущее напряжение батареи (V)** — вещественное число, 0–120
- **Общий пробег** — вещественное число, >=0, в км
- **Статус** — строка: доступен, арендован, на обслуживании, сломан

**Бизнес-правила:**
- Серийный номер уникален
- Ограничения по ёмкости и напряжению реализованы через валидаторы
- Автоматическая деградация батареи и обслуживание — **не реализовано на уровне модели**

### 3. Пользователь (User)
**Описание:** Пользователь системы

**Характеристики:**
- **Тип пользователя** — C (обычный), S (сотрудник), A (админ)
- **Имя пользователя** — строка, до 31 символа, уникальное
- **Email, имя, фамилия, телефон** — **отсутствуют**
- **Активность** — свойство, не поле
- **Дата регистрации** — **отсутствует**

**Бизнес-правила:**
- Email не используется
- Неактивность реализована только как свойство

### 4. Местоположение (SkateboardLocation)
**Описание:** История местоположений электроскейтбордов

**Характеристики:**
- **Широта** — вещественное число, -90.0 до 90.0
- **Долгота** — вещественное число, -180.0 до 180.0
- **Временная метка** — дата/время обновления
- **Адрес** — **отсутствует**

**Бизнес-правила:**
- Диапазоны координат валидируются
- Каждое обновление — новая запись (логика вне модели)

### 5. Отзыв (SkateboardReview)
**Описание:** Отзывы пользователей о электроскейтбордах

**Характеристики:**
- **Пользователь** — связь с User
- **Электроскейтборд** — связь с Skateboard
- **Оценка** — вещественное число, 1.0–5.0 (шаг не ограничен)
- **Текст** — текст
- **Дата создания/обновления** — **отсутствует**

**Бизнес-правила:**
- Ограничения на количество отзывов, редактирование, шаг оценки — **не реализованы**

## Основные бизнес-процессы

### 1. Аренда электроскейтборда
**Процесс:**
1. Пользователь находит доступный электроскейтборд на карте
2. Проверяется статус пользователя (активен, нет задолженностей)
3. Проверяется заряд батареи (минимум 20%)
4. Создается запись об аренде
5. Статус электроскейтборда меняется на "арендован"
6. Начинается отсчет времени аренды

**Бизнес-правила:**
- Минимальный заряд для аренды: 20%
- Максимальное время аренды: 24 часа
- Стоимость: 100 рублей в час
- Штраф за превышение времени: 200 рублей в час

### 2. Возврат электроскейтборда
**Процесс:**
1. Пользователь возвращает электроскейтборд в специальную зону
2. Система фиксирует новое местоположение
3. Обновляется пробег электроскейтборда
4. Рассчитывается стоимость аренды
5. Статус меняется на "доступен"
6. Если заряд ниже 10%, статус меняется на "на обслуживании"

**Бизнес-правила:**
- Электроскейтборд должен быть возвращен в специальную зону
- При возврате с зарядом ниже 10% взимается штраф 500 рублей
- Пробег рассчитывается по GPS координатам

### 3. Обслуживание электроскейтборда
**Процесс:**
1. Система автоматически отправляет электроскейтборд на обслуживание при:
   - Заряде ниже 10%
   - Пробеге более 1000 км
   - Получении 3+ отзывов с оценкой ниже 2.0
   - Здоровье батареи ниже 70%
2. Сотрудник проводит диагностику
3. При необходимости заменяется батарея
4. Обновляются характеристики
5. Статус меняется на "доступен"

**Бизнес-правила:**
- Обслуживание занимает 2-4 часа
- Стоимость обслуживания: 1000 рублей
- При замене батареи исходная емкость восстанавливается

### 4. Мониторинг состояния
**Процесс:**
1. Система постоянно отслеживает:
   - Заряд батареи всех электроскейтбордов
   - Здоровье батареи
   - Местоположение
   - Статус
   - Пробег
2. Генерируются уведомления при:
   - Низком заряде (< 10%)
   - Плохом здоровье батареи (< 70%)
   - Долгом отсутствии движения (> 2 часа)
   - Выходе из зоны обслуживания

## Технические особенности

### Батарея (ватт-часы)
- **Единица измерения:** Ватт-часы (Wh) = Ампер-часы (Ah) × Вольты (V)
- **Деградация:** Каждые 100 км пробега емкость уменьшается на 1%
- **Зарядка:** Происходит автоматически при подключении к зарядной станции
- **Время зарядки:** 2-4 часа в зависимости от модели
- **Критический заряд:** 10% - электроскейтборд отправляется на обслуживание
- **Критическое здоровье:** 70% - рекомендуется замена батареи

### GPS и местоположение
- **Частота обновления:** Каждые 5 минут при движении
- **Точность:** ±5 метров
- **Зоны обслуживания:** Определенные области для возврата
- **Геозоны:** Автоматическое определение выхода из зоны обслуживания

### Безопасность
- **Аутентификация:** JWT токены
- **Авторизация:** Роли пользователей
- **Шифрование:** Все данные передаются по HTTPS
- **Логирование:** Все действия пользователей логируются

## Монетизация

### Тарифы
- **Базовый тариф:** 100 рублей/час
- **Дневной тариф:** 800 рублей/день (8+ часов)
- **Недельный тариф:** 4000 рублей/неделя

### Штрафы
- **Превышение времени:** 200 рублей/час
- **Низкий заряд при возврате:** 500 рублей
- **Выход из зоны обслуживания:** 1000 рублей
- **Повреждение:** Стоимость ремонта + 1000 рублей

### Скидки
- **Постоянные клиенты:** 10% скидка после 10 аренд
- **Время суток:** 20% скидка с 22:00 до 6:00
- **Погода:** 15% скидка в дождь

## Аналитика и отчеты

### Метрики
- Количество аренд в день/неделю/месяц
- Среднее время аренды
- Популярные модели
- Доходы и расходы
- Состояние парка электроскейтбордов
- Среднее здоровье батарей

### Отчеты
- Ежедневные отчеты о состоянии парка
- Еженедельные финансовые отчеты
- Месячные аналитические отчеты
- Отчеты о техническом обслуживании
- Отчеты о состоянии батарей

## Прочие бизнес-процессы и правила

- Все бизнес-правила, не реализованные в моделях, должны быть реализованы на уровне бизнес-логики приложения или валидации API.
- В случае расхождений между этим документом и моделями Django, приоритет имеют модели.

## Примечание

Если вы добавляете или меняете поля в моделях, обязательно обновляйте этот документ для актуальности описания бизнес-логики.